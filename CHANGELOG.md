# Change Log

All notable changes to the "NoktoKalkulo" extension will be documented in this file.

## [Unreleased]

### Added

- ✨ **セリフと地の文の分離カウント機能**（2026-02-14）
  - かぎ括弧「」と二重かぎ括弧『』で囲まれたセリフを自動判別
  - セリフと地の文を分離して文字数をカウント
  - ステータスバークリックで詳細情報を出力パネルに表示
  - 詳細情報には以下を含む：
    - 現在のファイルとディレクトリ全体の総文字数
    - セリフの文字数と全体に占める割合（百分率）
    - 地の文の文字数と全体に占める割合（百分率）
  - 新しいコマンド追加：`NoktoKalkulo: Show Detailed Word Count`

### Changed

- ✨ **ステータスバー表示形式の改善**（2026-02-14）
  - 最小文字数をステータスバーから削除（背景色制御のみに使用）
  - より読みやすい表示形式に変更：`📝 現在 | 合計 / 目標 (達成率)`
  - 例：`📝 1,234字 | 3,456字 / 5,000字 (69%)`
  - 単一ファイルの場合は現在のファイルのみ表示：`📝 1,234字 / 5,000字 (25%)`
  - ステータスバークリックで詳細情報を表示するように変更

### Planned

- プロットファイルから目標文字数を自動抽出
- リアルタイム文字数グラフ
- 執筆速度の計測
- セクションごとの文字数内訳
- カスタマイズ可能なカウント規則
  - 会話文（「」内）を1文字としてカウントするオプション
  - 三点リーダー（…）を2文字としてカウントするオプション

## [0.1.0] - 2026-02-14

### Added

- ✅ **基本機能**
  - Markdown原稿ファイルの文字数カウント機能
  - ステータスバーへのリアルタイム表示
  - 目標文字数との比較表示（パーセンテージ）

- ✅ **カウント機能**
  - 文字要素のみをカウント（ひらがな、カタカナ、漢字、アルファベット、数字）
  - 記号、句読点、空白を除外
  - 全角・半角を問わず1文字としてカウント
  - Markdown要素の自動除外
    - 見出し行全体（`#` で始まる行）
    - リスト記号（`-`, `*`, `+`, `1.`）
    - コードブロック（` ``` `）
    - インラインコード（`` ` ``）
    - 引用行（`>` で始まる行）
    - HTMLコメント（`<!-- -->`）
    - HTMLタグ（`<tag>`）
    - 強調記号（`**`, `*`, `_`）

- ✅ **ディレクトリ合計機能**
  - 現在のファイルの文字数を表示
  - 同じディレクトリ配下（サブディレクトリ含む）の全 `.md` ファイルの合計文字数を表示

- ✅ **設定項目**
  - `nokto.wordCount.enabled` - 機能の有効/無効
  - `nokto.wordCount.minWords` - 最小文字数（0より大きい値で表示）
  - `nokto.wordCount.targetWords` - 目標文字数
  - `nokto.wordCount.showInStatusBar` - ステータスバー表示の切替
  - `nokto.wordCount.showBackgroundColor` - ステータスバー背景色表示の切替

- ✅ **ディレクトリ固有設定**
  - `.nokto.json` 設定ファイルのサポート
  - 作品ごとに異なる設定を指定可能
  - VS Code設定よりも優先される

- ✅ **背景色表示機能**
  - 合計文字数が最小文字数以下の場合：赤色
  - 合計文字数が目標文字数以上の場合：黄色
  - その他の場合：デフォルト

- ✅ **コマンド**
  - `NoktoKalkulo: Count Manuscript Words` - 手動カウント実行
  - `nokto.debugCount`（開発者向け） - デバッグ情報をコンソールに出力

### Technical

- TypeScript + ESBuild による実装
- ManuscriptParser による原稿解析
  - 正規表現ベースの文字要素抽出
  - Unicode範囲指定による正確なカウント
- StatusBarManager によるUI管理
  - 動的な背景色制御
  - 柔軟な表示フォーマット
- WordCountController によるイベント処理
  - エディタ切り替え時の自動更新
  - ドキュメント変更時の自動更新
  - 設定変更時の自動更新
  - ディレクトリ配下のファイル検索・集計

---

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

