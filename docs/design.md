# NoktoKalkulo - VS Codeæ‹¡å¼µæ©Ÿèƒ½è¨­è¨ˆ

å°èª¬åŸç¨¿ã®æœ¬æ–‡æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆæ‹¡å¼µæ©Ÿèƒ½

---

## æ©Ÿèƒ½æ¦‚è¦

MarkdownåŸç¨¿ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ã€Œ## æœ¬æ–‡ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ–‡å­—æ•°ã‚’æ­£ç¢ºã«ã‚«ã‚¦ãƒ³ãƒˆã—ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã«è¡¨ç¤ºã™ã‚‹ã€‚

---

## ã‚«ã‚¦ãƒ³ãƒˆå¯¾è±¡ã®ä»•æ§˜

### âœ… ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹æ–‡å­—

- ã€Œ## æœ¬æ–‡ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³é…ä¸‹ã®ã™ã¹ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆ
- æ—¥æœ¬èªæ–‡å­—ï¼ˆã²ã‚‰ãŒãªã€ã‚«ã‚¿ã‚«ãƒŠã€æ¼¢å­—ï¼‰
- è‹±æ•°å­—
- è¨˜å·ãƒ»å¥èª­ç‚¹

### âŒ ã‚«ã‚¦ãƒ³ãƒˆã—ãªã„æ–‡å­—

1. **ãƒ¡ã‚¿æƒ…å ±**
   - `# ã‚¿ã‚¤ãƒˆãƒ«` è¡Œï¼ˆæœ€ä¸Šä½ã®è¦‹å‡ºã—ï¼‰
   - `## æœ¬æ–‡` ã‚ˆã‚Šå‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³
   - `## æœ¬æ–‡` ã‚ˆã‚Šå¾Œã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ`## ãƒ¡ãƒ¢`ã€`## é€²æ—` ãªã©ï¼‰

2. **Markdownè¨˜æ³•**
   - è¦‹å‡ºã—è¨˜å·ï¼š`#`ã€`##`ã€`###`
   - ãƒªã‚¹ãƒˆè¨˜å·ï¼š`-`ã€`*`ã€`+`ã€`1.`
   - å¼·èª¿è¨˜å·ï¼š`**`ã€`*`ã€`__`ã€`_`
   - ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ï¼š` ``` `

3. **HTMLã‚³ãƒ¡ãƒ³ãƒˆ**
   - `<!-- ... -->` å†…ã®ã™ã¹ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆ
   - è¤‡æ•°è¡Œã«ã¾ãŸãŒã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚‚é™¤å¤–

4. **ç©ºç™½æ–‡å­—**
   - åŠè§’ã‚¹ãƒšãƒ¼ã‚¹
   - å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹
   - ã‚¿ãƒ–æ–‡å­—ï¼ˆ`\t`ï¼‰
   - æ”¹è¡Œã‚³ãƒ¼ãƒ‰ï¼ˆ`\n`ã€`\r\n`ï¼‰

---

## UIè¨­è¨ˆ

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼è¡¨ç¤º

```
ğŸ“ 5,432å­— / ç›®æ¨™: 5,000å­—
```

- å·¦å´ã®ã‚¢ã‚¤ã‚³ãƒ³ï¼šğŸ“ï¼ˆåŸç¨¿ã‚’ç¤ºã™ï¼‰
- ç¾åœ¨ã®æ–‡å­—æ•°ï¼šã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¡¨ç¤º
- ç›®æ¨™æ–‡å­—æ•°ï¼šãƒ—ãƒ­ãƒƒãƒˆæƒ…å ±ã‹ã‚‰è‡ªå‹•å–å¾—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- è‰²ï¼š
  - é€šå¸¸ï¼šç™½
  - ç›®æ¨™é”æˆï¼šç·‘
  - è¶…éï¼ˆ+10%ä»¥ä¸Šï¼‰ï¼šé»„è‰²

### ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆ

- `NoktoKalkulo: Count Manuscript Words` - æ‰‹å‹•ã‚«ã‚¦ãƒ³ãƒˆå®Ÿè¡Œ
- `NoktoKalkulo: Show Word Count Details` - è©³ç´°æƒ…å ±è¡¨ç¤º

---

## å®Ÿè£…æ–¹é‡

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
extension.ts
â”œâ”€â”€ activate() - æ‹¡å¼µæ©Ÿèƒ½ã®èµ·å‹•
â”œâ”€â”€ WordCountController - ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
â”‚   â”œâ”€â”€ updateWordCount() - æ–‡å­—æ•°æ›´æ–°
â”‚   â””â”€â”€ onDocumentChange() - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¤‰æ›´ç›£è¦–
â”œâ”€â”€ ManuscriptParser - åŸç¨¿ãƒ‘ãƒ¼ã‚µãƒ¼
â”‚   â”œâ”€â”€ extractMainSection() - æœ¬æ–‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³æŠ½å‡º
â”‚   â”œâ”€â”€ removeComments() - ã‚³ãƒ¡ãƒ³ãƒˆé™¤å»
â”‚   â”œâ”€â”€ removeMarkdownSyntax() - Markdownè¨˜æ³•é™¤å»
â”‚   â””â”€â”€ removeWhitespace() - ç©ºç™½é™¤å»
â””â”€â”€ StatusBarManager - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ç®¡ç†
    â”œâ”€â”€ update() - è¡¨ç¤ºæ›´æ–°
    â””â”€â”€ setTarget() - ç›®æ¨™æ–‡å­—æ•°è¨­å®š
```

### ManuscriptParser å®Ÿè£…è©³ç´°

```typescript
class ManuscriptParser {
  /**
   * æœ¬æ–‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŠ½å‡º
   * @param content - Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®å…¨å†…å®¹
   * @returns æœ¬æ–‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆ
   */
  extractMainSection(content: string): string {
    const lines = content.split('\n');
    let inMainSection = false;
    let mainContent: string[] = [];
    
    for (const line of lines) {
      // ã€Œ## æœ¬æ–‡ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
      if (line.trim() === '## æœ¬æ–‡') {
        inMainSection = true;
        continue;
      }
      
      // æ¬¡ã® ## ãƒ¬ãƒ™ãƒ«è¦‹å‡ºã—ã§çµ‚äº†
      if (inMainSection && line.match(/^##\s+(?!#+)/)) {
        break;
      }
      
      if (inMainSection) {
        mainContent.push(line);
      }
    }
    
    return mainContent.join('\n');
  }

  /**
   * HTMLã‚³ãƒ¡ãƒ³ãƒˆã‚’é™¤å»
   * @param content - ãƒ†ã‚­ã‚¹ãƒˆ
   * @returns ã‚³ãƒ¡ãƒ³ãƒˆé™¤å»å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆ
   */
  removeComments(content: string): string {
    // è¤‡æ•°è¡Œã‚³ãƒ¡ãƒ³ãƒˆã¨å˜ä¸€è¡Œã‚³ãƒ¡ãƒ³ãƒˆã®ä¸¡æ–¹ã«å¯¾å¿œ
    return content.replace(/<!--[\s\S]*?-->/g, '');
  }

  /**
   * Markdownè¨˜æ³•ã‚’é™¤å»
   * @param content - ãƒ†ã‚­ã‚¹ãƒˆ
   * @returns Markdownè¨˜æ³•é™¤å»å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆ
   */
  removeMarkdownSyntax(content: string): string {
    let text = content;
    
    // è¦‹å‡ºã—è¨˜å·ã‚’é™¤å»
    text = text.replace(/^#{1,6}\s+/gm, '');
    
    // å¼·èª¿è¨˜å·ã‚’é™¤å»
    text = text.replace(/(\*\*|__)(.*?)\1/g, '$2'); // Bold
    text = text.replace(/(\*|_)(.*?)\1/g, '$2');    // Italic
    
    // ãƒªã‚¹ãƒˆè¨˜å·ã‚’é™¤å»
    text = text.replace(/^[\s]*[-*+]\s+/gm, '');
    text = text.replace(/^[\s]*\d+\.\s+/gm, '');
    
    // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»
    text = text.replace(/```[\s\S]*?```/g, '');
    text = text.replace(/`([^`]+)`/g, '$1');
    
    // ãƒªãƒ³ã‚¯ã‚’é™¤å»ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã®ã¿æ®‹ã™
    text = text.replace(/\[([^\]]+)\]\([^\)]+\)/g, '$1');
    
    return text;
  }

  /**
   * ç©ºç™½æ–‡å­—ã‚’é™¤å»
   * @param content - ãƒ†ã‚­ã‚¹ãƒˆ
   * @returns ç©ºç™½é™¤å»å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆ
   */
  removeWhitespace(content: string): string {
    return content
      .replace(/\s+/g, '')  // ã™ã¹ã¦ã®ç©ºç™½æ–‡å­—ï¼ˆåŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã€å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã€ã‚¿ãƒ–ã€æ”¹è¡Œï¼‰
      .replace(/ã€€/g, '');   // å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆå¿µã®ãŸã‚æ˜ç¤ºçš„ã«ï¼‰
  }

  /**
   * æ–‡å­—æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
   * @param content - Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®å…¨å†…å®¹
   * @returns æ–‡å­—æ•°
   */
  countWords(content: string): number {
    const mainSection = this.extractMainSection(content);
    const withoutComments = this.removeComments(mainSection);
    const withoutMarkdown = this.removeMarkdownSyntax(withoutComments);
    const withoutWhitespace = this.removeWhitespace(withoutMarkdown);
    
    return withoutWhitespace.length;
  }
}
```

---

## è¨­å®šé …ç›®

`settings.json` ã§ä»¥ä¸‹ã‚’è¨­å®šå¯èƒ½ï¼š

```json
{
  "nocturne.wordCount.enabled": true,
  "nocturne.wordCount.targetWords": 5000,
  "nocturne.wordCount.autoTarget": true,
  "nocturne.wordCount.showInStatusBar": true,
  "nocturne.wordCount.updateDelay": 500
}
```

- `enabled` - æ©Ÿèƒ½ã®æœ‰åŠ¹/ç„¡åŠ¹
- `targetWords` - ç›®æ¨™æ–‡å­—æ•°ï¼ˆæ‰‹å‹•è¨­å®šï¼‰
- `autoTarget` - ãƒ—ãƒ­ãƒƒãƒˆã‹ã‚‰ç›®æ¨™ã‚’è‡ªå‹•å–å¾—
- `showInStatusBar` - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼è¡¨ç¤ºã®æœ‰åŠ¹/ç„¡åŠ¹
- `updateDelay` - æ›´æ–°ã®é…å»¶æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰

---

## ç›®æ¨™æ–‡å­—æ•°ã®è‡ªå‹•å–å¾—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ï¼‰

ãƒ—ãƒ­ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`plot/plot.md`ï¼‰ã‹ã‚‰ç›®æ¨™æ–‡å­—æ•°ã‚’è‡ªå‹•å–å¾—ï¼š

1. ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä½œå“ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç‰¹å®š
2. `plot/plot.md` ã‚’èª­ã¿è¾¼ã¿
3. ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œç´¢ï¼š
   - `åˆè¨ˆï¼šX,XXXï½X,XXXå­—`
   - `æ¨å¥¨æ–‡å­—æ•°ï¼šX,XXXå­—`
   - `ç›®æ¨™æ–‡å­—æ•°: X,XXXå­—`
4. ç¯„å›²æŒ‡å®šã®å ´åˆã¯ä¸­é–“å€¤ã‚’ä½¿ç”¨

---

## ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã®ã¿æœ‰åŠ¹åŒ–ï¼š

- `**/manuscript/draft/*.md`
- `**/manuscript/revised/*.md`
- `**/manuscript/final_manuscript.md`

---

## ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### 1. åŸºæœ¬çš„ãªæ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ

```markdown
## æœ¬æ–‡

ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆæ–‡ç« ã§ã™ã€‚
```

æœŸå¾…çµæœï¼š`11å­—`

### 2. ã‚³ãƒ¡ãƒ³ãƒˆé™¤å¤–

```markdown
## æœ¬æ–‡

<!-- ã“ã‚Œã¯ã‚³ãƒ¡ãƒ³ãƒˆ -->
æœ¬æ–‡ã¯ã“ã‚Œã ã‘ã€‚
```

æœŸå¾…çµæœï¼š`8å­—`

### 3. Markdownè¨˜æ³•é™¤å¤–

```markdown
## æœ¬æ–‡

### è¦‹å‡ºã—

ã“ã‚Œã¯**å¼·èª¿**ã•ã‚ŒãŸæ–‡ç« ã§ã™ã€‚
```

æœŸå¾…çµæœï¼š`15å­—`ï¼ˆã€Œè¦‹å‡ºã—ã€+ã€Œã“ã‚Œã¯å¼·èª¿ã•ã‚ŒãŸæ–‡ç« ã§ã™ã€ï¼‰

### 4. ç©ºç™½é™¤å¤–

```markdown
## æœ¬æ–‡

ã“ã‚Œã¯ã€€ãƒ†ã‚¹ãƒˆã€€ã§ã™ã€‚
æ”¹è¡Œã‚’å«ã‚€æ–‡ç« ã€‚
```

æœŸå¾…çµæœï¼š`17å­—`ï¼ˆç©ºç™½ã¨æ”¹è¡Œã‚’é™¤å¤–ï¼‰

### 5. è¤‡æ•°ã‚»ã‚¯ã‚·ãƒ§ãƒ³

```markdown
# ã‚¿ã‚¤ãƒˆãƒ«

## ãƒ¡ãƒ¢

ã“ã‚Œã¯ãƒ¡ãƒ¢ã§ã™ã€‚

## æœ¬æ–‡

ã“ã‚ŒãŒæœ¬æ–‡ã§ã™ã€‚

## é€²æ—

ã“ã‚Œã¯é€²æ—ãƒ¡ãƒ¢ã§ã™ã€‚
```

æœŸå¾…çµæœï¼š`7å­—`ï¼ˆã€Œã“ã‚ŒãŒæœ¬æ–‡ã§ã™ã€ã®ã¿ï¼‰

---

## å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
nocturne-word-count/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ extension.ts          # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ wordCountController.ts
â”‚   â”œâ”€â”€ manuscriptParser.ts
â”‚   â”œâ”€â”€ statusBarManager.ts
â”‚   â””â”€â”€ targetExtractor.ts    # ãƒ—ãƒ­ãƒƒãƒˆã‹ã‚‰ç›®æ¨™å–å¾—
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ suite/
â”‚   â”‚   â”œâ”€â”€ parser.test.ts
â”‚   â”‚   â””â”€â”€ controller.test.ts
â”‚   â””â”€â”€ fixtures/
â”‚       â””â”€â”€ sample.md
â””â”€â”€ README.md
```

---

## é–‹ç™ºæ‰‹é †

1. `yo code` ã§æ‹¡å¼µæ©Ÿèƒ½ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
2. ManuscriptParser ã‚¯ãƒ©ã‚¹å®Ÿè£…
3. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆãƒ»å®Ÿè¡Œ
4. WordCountController å®Ÿè£…
5. StatusBarManager å®Ÿè£…
6. çµ±åˆãƒ†ã‚¹ãƒˆ
7. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

---

## å°†æ¥ã®æ‹¡å¼µæ©Ÿèƒ½ï¼ˆPhase 2ï¼‰

- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ–‡å­—æ•°ã‚°ãƒ©ãƒ•
- åŸ·ç­†é€Ÿåº¦ã®è¨ˆæ¸¬
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã®æ–‡å­—æ•°å†…è¨³
- è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆè¨ˆæ–‡å­—æ•°
- ãƒ—ãƒ­ãƒƒãƒˆé…åˆ†ã¨ã®æ¯”è¼ƒè¡¨ç¤º
- åŸ·ç­†å±¥æ­´ã®è¨˜éŒ²
